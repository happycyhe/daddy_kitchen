<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Daddy's Kitchen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Playfair+Display:ital,wght@0,600;1,600&display=swap');

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #fdfbf7;
            color: #4a4a4a;
        }

        .font-serif {
            font-family: 'Playfair Display', serif;
        }

        .check-item input:checked + label {
            text-decoration: line-through;
            color: #a0a0a0;
        }
        
        .check-item input:checked + label::before {
            background-color: #fbbf24;
            border-color: #fbbf24;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .spin-slow {
            animation: spin 8s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* í˜ì´ì§€ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
        .memory-img {
            aspect-ratio: 1/1;
            object-fit: cover;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col relative overflow-hidden">

    <!-- ìƒë‹¨ í—¤ë” -->
    <header class="w-full px-6 py-4 flex justify-between items-center bg-white/80 backdrop-blur-md z-10 sticky top-0 border-b border-stone-100">
        <div class="flex items-center gap-2">
            <i class="fa-solid fa-utensils text-amber-500"></i>
            <h1 class="font-serif text-xl font-bold text-stone-800">Daddy's Kitchen</h1>
        </div>
        <div class="flex gap-4">
            <button onclick="openAddRecipeModal()" class="text-stone-600 hover:text-amber-500 transition">
                <i class="fa-solid fa-plus text-xl"></i>
            </button>
            <button onclick="toggleTimerModal()" class="text-stone-600 hover:text-amber-500 transition">
                <i class="fa-regular fa-clock text-xl"></i>
            </button>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  (ë ˆì‹œí”¼) -->
    <!-- ìŠ¤ì™€ì´í”„ ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•  ì˜ì—­ -->
    <main id="recipe-container" class="flex-1 overflow-y-auto pb-32 hide-scrollbar transition-opacity duration-300">
        <!-- ë ˆì‹œí”¼ ë‚´ìš©ì´ JSë¡œ ì—¬ê¸°ì— ë Œë”ë§ ë©ë‹ˆë‹¤ -->
    </main>

    <!-- í•˜ë‹¨ ë®¤ì§ í”Œë ˆì´ì–´ -->
    <div class="absolute bottom-0 w-full bg-white border-t border-stone-200 shadow-[0_-5px_20px_rgba(0,0,0,0.05)] px-6 py-4 z-20">
        <div class="w-full bg-stone-200 h-1 rounded-full mb-4 overflow-hidden cursor-pointer" id="progress-container">
            <div id="progress-bar" class="bg-amber-500 h-full w-0 transition-all duration-100"></div>
        </div>

        <div class="flex justify-between items-center">
            <div class="flex items-center gap-3 overflow-hidden">
                <div id="album-art" class="w-10 h-10 rounded-full bg-stone-800 flex items-center justify-center overflow-hidden shadow-md">
                    <img src="https://images.unsplash.com/photo-1459749411177-3a269496a607?w=100&auto=format&fit=crop" class="w-full h-full object-cover opacity-80">
                </div>
                <div class="flex-1 min-w-0">
                    <p id="song-title" class="font-bold text-sm text-stone-800 truncate">Sunday Morning</p>
                    <p id="artist-name" class="text-xs text-stone-500 truncate">Cooking Jazz Trio</p>
                </div>
            </div>

            <div class="flex items-center gap-4 text-stone-700">
                <button onclick="prevSong()" class="hover:text-amber-500"><i class="fa-solid fa-backward-step"></i></button>
                <button onclick="togglePlay()" class="w-10 h-10 bg-amber-500 rounded-full text-white flex items-center justify-center shadow-md hover:bg-amber-600 transition">
                    <i id="play-icon" class="fa-solid fa-play ml-1"></i>
                </button>
                <button onclick="nextSong()" class="hover:text-amber-500"><i class="fa-solid fa-forward-step"></i></button>
            </div>
        </div>
        <audio id="audio-player"></audio>
    </div>

    <!-- íƒ€ì´ë¨¸ ëª¨ë‹¬ -->
    <div id="timer-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center backdrop-blur-sm transition-opacity">
        <div class="bg-white rounded-3xl p-6 w-80 shadow-2xl text-center transform scale-100">
            <h3 class="text-xl font-bold mb-1 text-stone-800">í‚¤ì¹œ íƒ€ì´ë¨¸</h3>
            <p class="text-xs text-stone-400 mb-6">ë©´ ì‚¶ê¸°, ëœ¸ ë“¤ì´ê¸°ì— ì‚¬ìš©í•˜ì„¸ìš”</p>
            
            <div class="text-5xl font-mono font-bold text-amber-500 mb-8 tracking-widest" id="timer-display">00:00</div>
            
            <div class="grid grid-cols-3 gap-2 mb-6">
                <button onclick="addTime(60)" class="bg-stone-100 py-2 rounded-lg text-sm hover:bg-stone-200">+1ë¶„</button>
                <button onclick="addTime(180)" class="bg-stone-100 py-2 rounded-lg text-sm hover:bg-stone-200">+3ë¶„</button>
                <button onclick="addTime(300)" class="bg-stone-100 py-2 rounded-lg text-sm hover:bg-stone-200">+5ë¶„</button>
            </div>

            <div class="flex gap-3">
                <button onclick="resetTimer()" class="flex-1 py-3 rounded-xl bg-stone-200 text-stone-600 font-bold">ì´ˆê¸°í™”</button>
                <button onclick="toggleTimer()" id="timer-btn" class="flex-1 py-3 rounded-xl bg-amber-500 text-white font-bold shadow-lg">ì‹œì‘</button>
            </div>
            
            <button onclick="toggleTimerModal()" class="mt-4 text-sm text-stone-400 underline">ë‹«ê¸°</button>
        </div>
    </div>

    <!-- ë ˆì‹œí”¼ ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="add-recipe-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-end sm:items-center justify-center backdrop-blur-sm">
        <div class="bg-white w-full sm:w-96 h-[90vh] sm:h-auto sm:rounded-3xl rounded-t-3xl p-6 shadow-2xl flex flex-col overflow-hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-stone-800">ìƒˆ ë ˆì‹œí”¼ ì¶”ê°€</h3>
                <button onclick="closeAddRecipeModal()" class="text-stone-400 hover:text-stone-600"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            
            <div class="flex-1 overflow-y-auto space-y-4 pr-1 hide-scrollbar">
                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-1">ìš”ë¦¬ ì´ë¦„</label>
                    <input type="text" id="new-title" class="w-full border border-stone-200 rounded-xl px-4 py-2 focus:outline-none focus:border-amber-500" placeholder="ì˜ˆ: ê¹€ì¹˜ë³¶ìŒë°¥">
                </div>
                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-1">ì†Œê°œ (ì˜ì–´/ë¶€ì œ)</label>
                    <input type="text" id="new-subtitle" class="w-full border border-stone-200 rounded-xl px-4 py-2 focus:outline-none focus:border-amber-500" placeholder="ì˜ˆ: Kimchi Fried Rice">
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="block text-xs font-bold text-stone-500 mb-1">ì¡°ë¦¬ ì‹œê°„</label>
                        <input type="text" id="new-time" class="w-full border border-stone-200 rounded-xl px-4 py-2 focus:outline-none focus:border-amber-500" placeholder="ì˜ˆ: 15ë¶„">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-stone-500 mb-1">ì¸ë¶„</label>
                        <input type="text" id="new-servings" class="w-full border border-stone-200 rounded-xl px-4 py-2 focus:outline-none focus:border-amber-500" placeholder="ì˜ˆ: 1ì¸ë¶„">
                    </div>
                </div>
                
                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-1">ì¤€ë¹„ ì¬ë£Œ</label>
                    <div id="ingredient-input-list" class="space-y-2 mb-2"></div>
                    <button onclick="addIngredientRow()" class="text-xs flex items-center gap-1 text-amber-600 font-bold px-3 py-2 bg-amber-50 rounded-lg hover:bg-amber-100 transition">
                        <i class="fa-solid fa-plus"></i> ì¬ë£Œ ì¶”ê°€í•˜ê¸°
                    </button>
                </div>

                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-1">ì¡°ë¦¬ ìˆœì„œ (ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„)</label>
                    <textarea id="new-steps" class="w-full h-32 border border-stone-200 rounded-xl px-4 py-2 focus:outline-none focus:border-amber-500 resize-none" placeholder="1. íŒ¬ì— ê¸°ë¦„ì„ ë‘ë¥¸ë‹¤.&#10;2. ê¹€ì¹˜ë¥¼ ë³¶ëŠ”ë‹¤."></textarea>
                </div>
            </div>

            <button onclick="saveNewRecipe()" class="mt-4 w-full py-3 bg-amber-500 hover:bg-amber-600 text-white font-bold rounded-xl shadow-md transition">
                ë ˆì‹œí”¼ ì €ì¥í•˜ê¸°
            </button>
        </div>
    </div>

    <!-- ìˆ¨ê²¨ì§„ íŒŒì¼ ì¸í’‹ (ê°¤ëŸ¬ë¦¬ìš©) -->
    <input type="file" id="file-input" accept="image/*" class="hidden" onchange="handleImageUpload(event)">

    <script>
        // --- ë°ì´í„°: ë ˆì‹œí”¼ ëª©ë¡ ---
        const initialRecipes = [
            {
                title: "ê°ë°”ìŠ¤ ì•Œ ì•„íˆìš”",
                subtitle: "Gambas al Ajillo",
                difficulty: "ì‰¬ì›€",
                time: "25ë¶„",
                servings: "2ì¸ë¶„",
                image: "https://images.unsplash.com/photo-1565557623262-b51c2513a641?q=80&w=1000&auto=format&fit=crop",
                tag: "ìŠ¤í˜ì¸ ìš”ë¦¬",
                ingredients: [
                    { name: "ì¹µí…Œì¼ ìƒˆìš°", amount: "15~20ë§ˆë¦¬" },
                    { name: "ë§ˆëŠ˜", amount: "10~15í†¨" },
                    { name: "ì˜¬ë¦¬ë¸Œ ì˜¤ì¼", amount: "1ì»µ" },
                    { name: "í˜í˜ë¡ ì¹˜ë…¸", amount: "5~6ê°œ" },
                    { name: "ë°”ê²ŒíŠ¸ ë¹µ", amount: "ì ë‹¹ëŸ‰" }
                ],
                steps: [
                    { text: "ìƒˆìš°ëŠ” ë¬¼ê¸°ë¥¼ ì œê±°í•˜ê³  ì†Œê¸ˆ, í›„ì¶”ë¡œ ë°‘ê°„í•´ 10ë¶„ê°„ ì¬ì›Œë‘¡ë‹ˆë‹¤.", timer: 600 },
                    { text: "ë§ˆëŠ˜ì€ í¸ìœ¼ë¡œ ì°ê³ , í˜í˜ë¡ ì¹˜ë…¸ëŠ” ë¶€ëŸ¬ëœ¨ë ¤ ì¤€ë¹„í•©ë‹ˆë‹¤.", timer: null },
                    { text: "íŒ¬ì— ì˜¤ì¼ì„ ë¶“ê³  ì•½ë¶ˆì—ì„œ ë§ˆëŠ˜ì„ ë“ì…ë‹ˆë‹¤.", timer: null },
                    { text: "ë§ˆëŠ˜ì´ ë…¸ë¦‡í•´ì§€ë©´ í˜í˜ë¡ ì¹˜ë…¸ë¥¼ ë„£ì–´ í–¥ì„ ëƒ…ë‹ˆë‹¤. (ì•½ 1ë¶„)", timer: 60 },
                    { text: "ìƒˆìš°ë¥¼ ë„£ê³  ë¶‰ê²Œ ìµì„ ë•Œê¹Œì§€ ë“ì—¬ ì™„ì„±í•©ë‹ˆë‹¤.", timer: null }
                ]
            },
            {
                title: "ì•Œë¦¬ì˜¤ ì˜¬ë¦¬ì˜¤",
                subtitle: "Aglio e Olio",
                difficulty: "ë³´í†µ",
                time: "15ë¶„",
                servings: "1ì¸ë¶„",
                image: "https://images.unsplash.com/photo-1473093295043-cdd812d0e601?w=1000&auto=format&fit=crop",
                tag: "ì´íƒˆë¦¬ì•„ ìš”ë¦¬",
                ingredients: [
                    { name: "ìŠ¤íŒŒê²Œí‹° ë©´", amount: "100g" },
                    { name: "ë§ˆëŠ˜", amount: "8í†¨" },
                    { name: "ì˜¬ë¦¬ë¸Œ ì˜¤ì¼", amount: "50ml" },
                    { name: "í˜í˜ë¡ ì¹˜ë…¸", amount: "3ê°œ" },
                    { name: "ë©´ìˆ˜", amount: "1êµ­ì" }
                ],
                steps: [
                    { text: "ë“ëŠ” ë¬¼ì— ì†Œê¸ˆì„ ë„£ê³  ë©´ì„ 8ë¶„ê°„ ì‚¶ìŠµë‹ˆë‹¤.", timer: 480 },
                    { text: "íŒ¬ì— ì˜¤ì¼ì„ ë‘ë¥´ê³  í¸ë§ˆëŠ˜ì„ ì•½ë¶ˆì— ë³¶ìŠµë‹ˆë‹¤.", timer: null },
                    { text: "ë§ˆëŠ˜ í–¥ì´ ì˜¬ë¼ì˜¤ë©´ ë©´ê³¼ ë©´ìˆ˜ë¥¼ ë„£ê³  ë³¶ì•„ ìœ í™”ì‹œí‚µë‹ˆë‹¤.", timer: null },
                    { text: "ë¶ˆì„ ë„ê³  í›„ì¶”ì™€ íŒŒìŠ¬ë¦¬ë¥¼ ë¿Œë ¤ ì™„ì„±í•©ë‹ˆë‹¤.", timer: null }
                ]
            }
        ];

        let recipes = [...initialRecipes];
        let currentRecipeIdx = 0;

        // --- ì¶”ì–µ ì•¨ë²” (Local Storage) ê¸°ëŠ¥ ---
        // ë©”ëª¨ë¦¬ êµ¬ì¡°: { "ë ˆì‹œí”¼ì œëª©": [ { date: "2023-10-27", image: "base64..." }, ... ] }
        function getMemories(recipeTitle) {
            const allMemories = JSON.parse(localStorage.getItem('daddys_kitchen_memories') || '{}');
            return allMemories[recipeTitle] || [];
        }

        function saveMemory(recipeTitle, imageData) {
            const allMemories = JSON.parse(localStorage.getItem('daddys_kitchen_memories') || '{}');
            if (!allMemories[recipeTitle]) {
                allMemories[recipeTitle] = [];
            }
            
            const today = new Date().toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' });
            
            allMemories[recipeTitle].unshift({
                date: today,
                image: imageData,
                id: Date.now()
            });

            try {
                localStorage.setItem('daddys_kitchen_memories', JSON.stringify(allMemories));
                renderRecipe(currentRecipeIdx); // í™”ë©´ ê°±ì‹ 
            } catch (e) {
                alert("ì €ì¥ ìš©ëŸ‰ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! ì˜¤ë˜ëœ ì‚¬ì§„ì„ ì§€ì›Œì£¼ì„¸ìš”.");
            }
        }

        function deleteMemory(recipeTitle, id) {
            if(!confirm("ì´ ì¶”ì–µ ì‚¬ì§„ì„ ì‚­ì œí• ê¹Œìš”?")) return;

            const allMemories = JSON.parse(localStorage.getItem('daddys_kitchen_memories') || '{}');
            if (allMemories[recipeTitle]) {
                allMemories[recipeTitle] = allMemories[recipeTitle].filter(m => m.id !== id);
                localStorage.setItem('daddys_kitchen_memories', JSON.stringify(allMemories));
                renderRecipe(currentRecipeIdx);
            }
        }

        function triggerFileInput() {
            document.getElementById('file-input').click();
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const currentTitle = recipes[currentRecipeIdx].title;
                saveMemory(currentTitle, e.target.result);
            };
            reader.readAsDataURL(file);
            
            // ì¸í’‹ ì´ˆê¸°í™” (ê°™ì€ íŒŒì¼ ë‹¤ì‹œ ì„ íƒ ê°€ëŠ¥í•˜ê²Œ)
            event.target.value = '';
        }


        // --- ë Œë”ë§ ë¡œì§ ---
        const recipeContainer = document.getElementById('recipe-container');

        function renderRecipe(idx) {
            const recipe = recipes[idx];
            const memories = getMemories(recipe.title);
            
            // HTML ìƒì„±
            let html = `
                <div class="fade-in">
                    <!-- ë ˆì‹œí”¼ íˆì–´ë¡œ ì´ë¯¸ì§€ -->
                    <div class="relative w-full h-64 bg-stone-200">
                        <img src="${recipe.image}" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex items-end p-6">
                            <div class="w-full flex justify-between items-end">
                                <div>
                                    <span class="bg-amber-500 text-white text-xs px-2 py-1 rounded-full mb-2 inline-block shadow-sm">${recipe.tag || 'ë‚˜ë§Œì˜ ìš”ë¦¬'}</span>
                                    <h2 class="text-3xl text-white font-serif font-bold drop-shadow-md">${recipe.title}</h2>
                                    <p class="text-stone-200 text-sm mt-1">${recipe.subtitle}</p>
                                </div>
                                <div class="text-white/80 text-xs bg-black/30 px-3 py-1 rounded-full backdrop-blur-sm">
                                    ${idx + 1} / ${recipes.length}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ë ˆì‹œí”¼ ì •ë³´ -->
                    <div class="px-6 py-6">
                        <div class="flex justify-between text-center mb-8 bg-white p-4 rounded-2xl shadow-sm border border-stone-100">
                            <div>
                                <p class="text-xs text-stone-400 mb-1">ë‚œì´ë„</p>
                                <p class="font-bold text-stone-700">${recipe.difficulty || 'ë³´í†µ'}</p>
                            </div>
                            <div class="w-px bg-stone-200"></div>
                            <div>
                                <p class="text-xs text-stone-400 mb-1">ì¡°ë¦¬ì‹œê°„</p>
                                <p class="font-bold text-stone-700">${recipe.time}</p>
                            </div>
                            <div class="w-px bg-stone-200"></div>
                            <div>
                                <p class="text-xs text-stone-400 mb-1">ì¸ë¶„</p>
                                <p class="font-bold text-stone-700">${recipe.servings}</p>
                            </div>
                        </div>

                        <!-- ì¬ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
                        <section class="mb-8">
                            <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-basket-shopping text-amber-500 text-sm"></i> ì¤€ë¹„ ì¬ë£Œ
                            </h3>
                            <div class="space-y-3">
            `;

            recipe.ingredients.forEach((ing, i) => {
                let amountHtml = '';
                if(ing.amount && ing.amount.trim() !== '') {
                    amountHtml = `<span class="text-xs text-amber-600 font-medium bg-amber-50 px-2 py-1 rounded-md ml-2 whitespace-nowrap">${ing.amount}</span>`;
                }
                
                html += `
                    <div class="flex items-center justify-between check-item bg-white p-3 rounded-xl border border-stone-100 shadow-sm">
                        <div class="flex items-center gap-3 overflow-hidden">
                            <input type="checkbox" id="ing-${i}" class="w-5 h-5 accent-amber-500 rounded cursor-pointer flex-shrink-0">
                            <label for="ing-${i}" class="cursor-pointer select-none text-stone-700 truncate">${ing.name}</label>
                        </div>
                        ${amountHtml}
                    </div>
                `;
            });

            html += `
                            </div>
                        </section>

                        <!-- ì¡°ë¦¬ ìˆœì„œ -->
                        <section class="mb-8">
                            <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-fire-burner text-amber-500 text-sm"></i> ì¡°ë¦¬ ìˆœì„œ
                            </h3>
                            <div class="space-y-6">
            `;

            recipe.steps.forEach((step, i) => {
                let timerBtnHtml = '';
                if(step.timer) {
                    const minutes = Math.floor(step.timer / 60);
                    const seconds = step.timer % 60;
                    const timeText = minutes > 0 ? `${minutes}ë¶„` : `${seconds}ì´ˆ`;
                    timerBtnHtml = `
                        <button onclick="setAndStartTimer(${step.timer}, event)" class="mt-2 flex items-center gap-2 bg-amber-100 hover:bg-amber-200 text-amber-700 text-sm px-3 py-2 rounded-lg font-bold transition-colors">
                            <i class="fa-solid fa-stopwatch"></i> ${timeText} íƒ€ì´ë¨¸ ì‹œì‘
                        </button>
                    `;
                }

                html += `
                    <div class="flex gap-4 group">
                        <div class="flex-shrink-0 w-8 h-8 rounded-full bg-amber-100 text-amber-600 flex items-center justify-center font-bold text-sm mt-1 group-hover:bg-amber-500 group-hover:text-white transition-colors">
                            ${i + 1}
                        </div>
                        <div class="flex-1">
                            <p class="text-stone-600 leading-relaxed cursor-pointer" onclick="this.classList.toggle('line-through'); this.classList.toggle('opacity-40')">
                                ${step.text}
                            </p>
                            ${timerBtnHtml}
                        </div>
                    </div>
                `;
            });

            html += `
                            </div>
                        </section>

                        <!-- ì¶”ì–µ ì•¨ë²” ì„¹ì…˜ (ìƒˆë¡œ ì¶”ê°€ë¨) -->
                        <section class="mb-4">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-bold text-lg flex items-center gap-2">
                                    <i class="fa-solid fa-camera text-amber-500 text-sm"></i> ìš”ë¦¬ ì¶”ì–µ ì•¨ë²”
                                </h3>
                                <button onclick="triggerFileInput()" class="text-xs bg-amber-100 hover:bg-amber-200 text-amber-700 px-3 py-1.5 rounded-full font-bold transition">
                                    <i class="fa-solid fa-plus mr-1"></i> ì¶”ì–µ ë‚¨ê¸°ê¸°
                                </button>
                            </div>

                            ${memories.length === 0 ? 
                                `<div class="text-center py-6 bg-stone-50 rounded-xl border border-dashed border-stone-300 text-stone-400 text-sm">
                                    ì•„ì§ ê¸°ë¡ëœ ì¶”ì–µì´ ì—†ì–´ìš”.<br>ì˜¤ëŠ˜ ë§Œë“  ìš”ë¦¬ë¥¼ ì°ì–´ë³´ì„¸ìš”!
                                </div>` : 
                                `<div class="space-y-4">
                                    ${memories.map(m => `
                                        <div>
                                            <p class="text-xs font-bold text-stone-500 mb-2 pl-1">ğŸ“… ${m.date}</p>
                                            <div class="relative group">
                                                <img src="${m.image}" class="w-full memory-img shadow-sm border border-stone-100">
                                                <button onclick="deleteMemory('${recipe.title}', ${m.id})" class="absolute top-2 right-2 bg-black/50 text-white w-8 h-8 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition backdrop-blur-sm">
                                                    <i class="fa-solid fa-trash text-xs"></i>
                                                </button>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>`
                            }
                        </section>

                        <div class="h-10"></div>
                        
                        <div class="text-center text-xs text-stone-400 pb-4">
                            <i class="fa-solid fa-arrow-left mr-1"></i> í™”ë©´ì„ ë°€ì–´ì„œ ë‹¤ë¥¸ ë ˆì‹œí”¼ ë³´ê¸° <i class="fa-solid fa-arrow-right ml-1"></i>
                        </div>
                    </div>
                </div>
            `;

            recipeContainer.innerHTML = html;
        }

        // --- ìŠ¤ì™€ì´í”„ ê¸°ëŠ¥ ---
        let touchStartX = 0;
        let touchEndX = 0;

        recipeContainer.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        }, {passive: true});

        recipeContainer.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        }, {passive: true});

        function handleSwipe() {
            if (touchEndX > touchStartX + 50) {
                if(currentRecipeIdx > 0) {
                    currentRecipeIdx--;
                    renderRecipe(currentRecipeIdx);
                }
            }
            if (touchEndX < touchStartX - 50) {
                if(currentRecipeIdx < recipes.length - 1) {
                    currentRecipeIdx++;
                    renderRecipe(currentRecipeIdx);
                }
            }
        }

        // --- ë ˆì‹œí”¼ ì¶”ê°€ ê¸°ëŠ¥ ---
        const addRecipeModal = document.getElementById('add-recipe-modal');
        const ingredientInputList = document.getElementById('ingredient-input-list');

        function openAddRecipeModal() {
            addRecipeModal.classList.remove('hidden');
            if(ingredientInputList.children.length === 0) {
                addIngredientRow();
            }
        }

        function closeAddRecipeModal() {
            addRecipeModal.classList.add('hidden');
        }

        function addIngredientRow() {
            const div = document.createElement('div');
            div.className = "flex gap-2 items-center";
            div.innerHTML = `
                <input type="text" class="ing-name flex-1 border border-stone-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-amber-500" placeholder="ì¬ë£Œëª… (ì˜ˆ: ê¹€ì¹˜)">
                <input type="text" class="ing-amount w-24 border border-stone-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-amber-500" placeholder="ì–‘ (ì˜ˆ: 1ì»µ)">
                <button onclick="this.parentElement.remove()" class="text-stone-400 hover:text-red-500 px-1"><i class="fa-solid fa-minus"></i></button>
            `;
            ingredientInputList.appendChild(div);
        }

        function saveNewRecipe() {
            const title = document.getElementById('new-title').value;
            const subtitle = document.getElementById('new-subtitle').value;
            const time = document.getElementById('new-time').value;
            const servings = document.getElementById('new-servings').value;
            const stepsText = document.getElementById('new-steps').value;

            const ingNames = document.querySelectorAll('.ing-name');
            const ingAmounts = document.querySelectorAll('.ing-amount');
            const ingredients = [];

            ingNames.forEach((input, index) => {
                if(input.value.trim() !== '') {
                    ingredients.push({
                        name: input.value,
                        amount: ingAmounts[index].value || ''
                    });
                }
            });

            if(!title || !stepsText || ingredients.length === 0) {
                alert("ìš”ë¦¬ ì´ë¦„, ì¬ë£Œ(ìµœì†Œ 1ê°œ), ì¡°ë¦¬ ìˆœì„œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤!");
                return;
            }

            const steps = stepsText.split('\n').filter(line => line.trim() !== '').map(line => {
                return { text: line, timer: null }; 
            });

            const randomImages = [
                "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=1000",
                "https://images.unsplash.com/photo-1482049016688-2d3e1b311543?w=1000",
                "https://images.unsplash.com/photo-1493770348161-369560ae357d?w=1000"
            ];
            const randomImg = randomImages[Math.floor(Math.random() * randomImages.length)];

            const newRecipe = {
                title, subtitle, difficulty: "ë¯¸ì •", time, servings, 
                image: randomImg, tag: "ë‚˜ë§Œì˜ ìš”ë¦¬", ingredients, steps
            };

            recipes.push(newRecipe);
            currentRecipeIdx = recipes.length - 1; 
            renderRecipe(currentRecipeIdx);
            
            document.getElementById('new-title').value = '';
            document.getElementById('new-subtitle').value = '';
            document.getElementById('new-time').value = '';
            document.getElementById('new-servings').value = '';
            document.getElementById('new-steps').value = '';
            ingredientInputList.innerHTML = '';
            
            closeAddRecipeModal();
            alert("ë ˆì‹œí”¼ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!");
        }

        // --- ìŒì•… í”Œë ˆì´ì–´ ë¡œì§ ---
        const playlist = [
            {
                title: "Cafe Jazz Vibes",
                artist: "Background Music",
                src: "https://files.freemusicarchive.org/storage-freemusicarchive-org/music/ccCommunity/Chad_Crouch/Arps/Chad_Crouch_-_Elipsis.mp3",
                cover: "https://images.unsplash.com/photo-1511192336575-5a79af67a629?w=100&auto=format&fit=crop"
            },
            {
                title: "Soft Piano Cooking",
                artist: "Daddy's Kitchen",
                src: "https://files.freemusicarchive.org/storage-freemusicarchive-org/music/ccCommunity/Kai_Engel/Satin/Kai_Engel_-_04_-_Sentinel.mp3",
                cover: "https://images.unsplash.com/photo-1520523839897-bd0b52f945a0?w=100&auto=format&fit=crop"
            }
        ];

        const audio = document.getElementById('audio-player');
        const playBtnIcon = document.getElementById('play-icon');
        const progressBar = document.getElementById('progress-bar');
        const progressContainer = document.getElementById('progress-container');
        const albumArt = document.getElementById('album-art');
        
        let currentSongIdx = 0;
        let isPlaying = false;

        function loadSong(song) {
            document.getElementById('song-title').innerText = song.title;
            document.getElementById('artist-name').innerText = song.artist;
            document.querySelector('#album-art img').src = song.cover;
            audio.src = song.src;
        }

        function togglePlay() {
            if (isPlaying) {
                audio.pause();
                playBtnIcon.classList.replace('fa-pause', 'fa-play');
                albumArt.classList.remove('spin-slow');
            } else {
                audio.play();
                playBtnIcon.classList.replace('fa-play', 'fa-pause');
                albumArt.classList.add('spin-slow');
            }
            isPlaying = !isPlaying;
        }

        function nextSong() {
            currentSongIdx = (currentSongIdx + 1) % playlist.length;
            loadSong(playlist[currentSongIdx]);
            if(isPlaying) audio.play();
        }

        function prevSong() {
            currentSongIdx = (currentSongIdx - 1 + playlist.length) % playlist.length;
            loadSong(playlist[currentSongIdx]);
            if(isPlaying) audio.play();
        }

        audio.addEventListener('timeupdate', (e) => {
            const { duration, currentTime } = e.srcElement;
            const progressPercent = (currentTime / duration) * 100;
            progressBar.style.width = `${progressPercent}%`;
        });

        progressContainer.addEventListener('click', (e) => {
            const width = progressContainer.clientWidth;
            const clickX = e.offsetX;
            const duration = audio.duration;
            audio.currentTime = (clickX / width) * duration;
        });

        audio.addEventListener('ended', nextSong);

        // --- íƒ€ì´ë¨¸ ë¡œì§ ---
        let timerTime = 0;
        let timerInterval;
        let isTimerRunning = false;
        const timerDisplay = document.getElementById('timer-display');
        const timerBtn = document.getElementById('timer-btn');
        const timerModal = document.getElementById('timer-modal');

        function toggleTimerModal() {
            timerModal.classList.toggle('hidden');
        }

        function setAndStartTimer(seconds, event) {
            if(event) event.stopPropagation();
            timerTime = seconds;
            updateTimerDisplay();
            timerModal.classList.remove('hidden');
            stopTimer();
            startTimer();
        }

        function updateTimerDisplay() {
            const m = Math.floor(timerTime / 60).toString().padStart(2, '0');
            const s = (timerTime % 60).toString().padStart(2, '0');
            timerDisplay.innerText = `${m}:${s}`;
        }

        function addTime(seconds) {
            timerTime += seconds;
            updateTimerDisplay();
        }

        function resetTimer() {
            stopTimer();
            timerTime = 0;
            updateTimerDisplay();
        }

        function toggleTimer() {
            if (isTimerRunning) {
                stopTimer();
            } else {
                if(timerTime > 0) startTimer();
            }
        }

        function startTimer() {
            isTimerRunning = true;
            timerBtn.innerText = "ì¼ì‹œì •ì§€";
            timerBtn.classList.replace('bg-amber-500', 'bg-red-500');
            
            timerInterval = setInterval(() => {
                if (timerTime > 0) {
                    timerTime--;
                    updateTimerDisplay();
                } else {
                    stopTimer();
                    alert("â° íƒ€ì´ë¨¸ ì¢…ë£Œ! ìš”ë¦¬ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
                    try { new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg').play(); } catch(e){}
                }
            }, 1000);
        }

        function stopTimer() {
            isTimerRunning = false;
            clearInterval(timerInterval);
            timerBtn.innerText = "ì‹œì‘";
            timerBtn.classList.replace('bg-red-500', 'bg-amber-500');
        }

        // ì´ˆê¸° ì‹¤í–‰
        loadSong(playlist[0]);
        renderRecipe(0);
    </script>
</body>
</html>